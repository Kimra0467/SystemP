# Week10
240507  

하드디스크 구조  
플래터, 섹터, 실린더  

### EXT4, XFS, ZFS, NTFS 발표  
file system  
장치에 데이터를 저장할 때 데이터의 위치나 파일명, 형식 등을 결정하는 방법  

저널링(Journaling)  
db에서 일관성 체크를 위해 사용되는 방법  
파일 시스템이 깨지는 것과 같은 시스템 장애를 방지하기 위해 저널을 남겨두는 기능  
매일 갱신되는 데이터의 변경이력을 남기는 것  
데이터 복구, 백업 등에 이용  

EXT4  
우분투 및 데비안과 같이 널리 사용되는 리눅스 배포판의 기본 저널링 파일 시스템으로 사용  
성능 확정성 및 신뢰성을 향상시킨 수많은 새 기능 도입  
1EB의 파일 시스템을 지원  

특징 및 기능  
대용량 파일 시스템  
파일 시스템 볼륨, 파일 크기 및 서브디렉토리 제한에 대한 지원이 향상  
최대 1EB의 파일 시스템을 지원  
ext4에서 허용되는 최대 파일 크기는 16TB  
서브 디렉토리 제한도 32kb디렉토리 깊이에서 거의 무한대로 확장  

익스텐트 
대용량 파일의 메타데이터를 줄이고 성능 향상시키기 위한 기법  
연속 블록으로 구성된 긴 목록의 저장 위치에 대한 정보가 유지되기 때문에 저장되는 전체 메타데이터의 용량이줄어듦  
계층화된 접근 방법을 통해 작은 파일을 효율적으로 나타냄  
익스텐트 트리르 사용하여 대용량 파일을 효율적으로 나타냄  

파일 시스템 저널에 대한 체크섬 검사  
안정적으로 변경 사항을 구현  
작업 중에 시스템 오류 또는 전원 문제가 발생하더라도 일관성 유지  
저널에 대한 체크섬 기능을 구현하여 올바른 변경 사항만 기본 파일 시스템에 적용되도록 보장  

사전할당(pre-allocation), wldusgkfekd(delayed-allocation)  
사전할당은 파일 생성 시 미리 일정 개수의 블록을 보장하는 기법
fallocate() 시스템 콜 사용 사전할당 기능을 제공  
지연할당은 free block count만 갱신하고 실제 블록 할당은 뒤로 미루는 방식  
block allocator가 블록 할당을 최적화할 수 있기 때문에 성능이 향상되고 fragmentation을 개선  

XFS  
강력하고 확정 높은 단일 호스트 64비트 저널링 파일 시스템  
익스텐스 기반으로 매우 큰 파일 시스템을 지원  
빠른 복구를 위한 메타데이터 저널링 지원  
마운트되어 할성화된 상태로 조각 모음 및 확장 가능  
특정 유틸리티의 백업 및 복원을 지원  
b-tree 구조를 사용하여 우수한 i/o확장성을 제공하고 모든 사용자 데이터 및 메타 데이터를 인덱스  

특징 및 기능  
저널링  
파일 수에 관계없이 예상치 못한 상황으로부터 신속하게 복구하여 재시작 가능  
익스텐스 기반으로 매우 큰 파일 시스템을 지원  
XFS는 체크 프로그램을 사용하지 않아도 된다. 이를 통해 데이터 손실 가능성을 줄일 수 있다.  
  
익스텐트 기반 할당  
메타데이터가 소비되는 공간과 조각화를 최소화하며, 대용량 파일의 성능을 향상  
지연 할당과 사전 할당 또한 지원, 성능 저하 최소화  

트랜잭션  
데이터 읽기/쓰기 트랜잭션으로 인한 성능 저하를 최소화  
XFS의 저널링 구조와 알고리즘은 트랜잭션에 대한 로그 기록을 신속하게 할 수 있도록 최적화  
  
높은 확장성  
완전한 64비트 파일 시스템 100만TB크기의 파일도 다룸  
사용가능한 공간에 의해서만 파일 수가 제한되며, 마운트 된 상태에서 확장이 가능  

ZFS  
안정성과 성능, 데이터 보호 기능들이 강화된 파일 스토리지를 목적으로 개발  
핵심 컨셉은 파일 시스템과 볼륨 매니저를 같이 제공  
물리적인 스토리지와 이로 구성된 볼륨 구조 뿐만 아니라 여기에 저장된 파일에 대한 정보도 가지고 있다.  

특징 및 기능  
스토리지 풀  
볼륨 확장 혹은 디스크 추가 시 스토리지 풀에 결합, 결합 직후 직시 용량이 반영되어 사용이 가능  
임의의 데이터 저장소 역할을 수행하며, 모든 파일 시스템이 스토리지 풀로 구성된 스토리지에 데이터 저장이 가능  
실제로 사용한 공간 만큼만 차지하기 때문에 효율적으로 디스크 사용 가능  

COW(copy-on-write)트랜잭션  
스토리지에서 데이터를 관리하기 위해 기록 시 복사모델을 사용  
이전 데이터는 새로운 쓰기 작업이 완료된 후에 유지되고 데이터를 절대 겹쳐 쓰지 않기 때문에 변경 작업이 완룍되면 포인터를 새로 쓰여진 블록으로 변경하여 저장  

체크섬  
중복검사의 한 형태, 오류 정정을 통해 공간이나 송신되 자료의 무결성을 검증하는 방법  
메모리 기반의 엔드 투 엔드 체크섬을 제공  
메모리 기반이기 때문에 유효성 검사 시 서버 메모리 하에서 작업이 이루어져 외부 작업이 가능하며, 체크섬 데이터는 블록을 가리키는 포인터의 옆에 저장  
  
findmnt, NTFS  
NTFS 안정성 강화 기능  
저널링, VSC  
  
### lunux 파일 시스템 & 디스크 관리 명령어
df, du, lsblk, fdisk, blkid, mount  
파일시스템과 디스크 관리에 사용되는 명령어들  
디스크 공간 모니터링, 파티션 관리  

파일 시스템 이란?  
파일은 문서, 사진, 동영상 등 모든 데이터  
컴퓨터에서 파일을 보관하고 관리하는 방법  
파일들을 잘 정리하고 찾기 쉽게 만들어준다  


df = 디스크 여유 공간 표시  

df?  
df 명령어는 컴퓨터에 연결된 모든 저장 장치의 사용량을 보여주는 명령어  
저장 장치에 얼마나 많은 공간이 남아있는지, 얼마나 많은 공간을 사용하고 있는지 알 수 있음  
df -h 용량을 알기 쉬운 단위로 보여준다  
df -T 입력하면 저장 장치의 종류(ext4, FAT32 등)도 함께 볼 수 있다.  
  
du = 디스크 사용량 표시  
  
du?  
파일이나 폴더의 용량을 확인할 수 있는 명령어  
du -h 용량을 알기 쉬운 단위로 보여준다  
du -s 현재 폴더 전체의 총 용량만 보여준다.  
du -d 1 폴더 안의 1단계 폴더들의 용량만 보여준다  
  
lsblk(list block devices) = 블록 장치의 정보를 목록으로 표시  

lsblk?  
리눅스 운영 체제에서 사용할 수 있는 명령어  
컴퓨터에 연결된 모든 저장 장치를 확인할 수 있다.  
  
lsblk -f 저장 장치의 파일 시스템 정보 함께 봄  
lsblk -p 저장 장치의 전체 경로를 볼 수 있다.  
lsblk -t 저장 장치의 마운트 시간 정보를 볼 수 있다.  

  
fdisk = 하드디스크 파티션을 생성, 수정, 삭제할 수 있는 도구(파티션 관리)  

fdisk?  
리눅스에서 사용 연결된 하드 디스크나 ssd와 같은 저장 장치를 관리  
파티션을 만들거나 삭제하는 등의 작업을 할 수 있다.  

fdisk /dev/sda = 첫번째 하드 디스크를 관리  
n = 새로운 파티션  
d = 기존 파티션 삭제  
w = 변경 사항 저장 fdisk 종료  
q = 변경 사항 저장 x, fdisk 종료  

blkid = 블록 장치의 uuid, 파일 시스템 유형 정보들을 출력  

blkid?  
하드디스크, ssd, usb memory 등의 저장 장치 정보를 볼 수 있다.  
파티션 정보, 파일 시스템 정보, uuid 등 확인  
blkid /dev/sda1 특정 파티션의 정보 확인  
blkid -t TYPE=ext4와 같은 파일 시스템 타입으로 검색  
blkid -U ~uuid 와 같이 uuid로 검색할 수 있다.  


mount = 파일 시스템을 디렉토리에 연결함  
  
mount?  
컴퓨터에 저장 장치를 연결  
하드 디스크, usb, cd/dvd 장치들을 컴퓨터에 연결하여 사용할 수 있게하는 것  
mount /dev/sdb1 /mnt 와 같이 특정 파티션을 특정 폴더에 연결  
mount -t /mnt와 같이 파일 시스템 타입을 지정  
mount -o ro /dev/sdb1 /mnt 와 같이 읽기 전용으로 연결  

### fsck, badblocks  
사용 경우  
정기적인 유지보수, 시스템 부팅 실패, 디스크 오류 발생, 새로운 하드웨어 설치  
  
badblock = badsector  
  
soft = 정전, 비트 오류, 펌웨어 등의 문제  
hard = 저장 장치에 물리적인 문제  
  
fsck = file system check  
파일 시스템에서 파일을 체크하고 수리하는 명령어  
ms-dos, ms windows -> chkdsk, sfc, scandisk  
  
fsck [-AVRTNP][-s][-t 파일 시스템 유형][ 파일 시스템 옵션] 파일 시스템 [...]  
명령어 sudo fsck /dev/sdb  
  
badblocks  
하드디스크나 기타 저장 장치의 배드 블록을 검사하는 명령어  
  
badblocks [-b 블록크기 ] [-o 출력파일 ] [-v] [-w]  


